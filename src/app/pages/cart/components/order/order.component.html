<p-toast></p-toast>
<!-- Popup Select delivery info -->
<p-dialog header="Th√™m ƒë·ªïi ƒë·ªãa ch·ªâ nh·∫≠n h√†ng" [(visible)]="visibleAddDeliveryInfoDialog"
          [appendTo]="'body'" [modal]="true" [style]="{width: '480px'}"
          (onHide)="toggleVisibleAddDeliveryInfoDialog(false)">
  <ng-template pTemplate="content">
    <form [formGroup]="formGroupDeliveryInfo" autocomplete="off">
      <div *ngFor="let settingControl of settingControlsDeliveryInfo">
        <dynamic-form [formGroup]="formGroupDeliveryInfo" [settingControl]="settingControl"
                      [settingControls]="settingControlsDeliveryInfo" [isSubmit]="isSubmitDeliveryInfoDialog">
        </dynamic-form>
      </div>
    </form>
  </ng-template>

  <ng-template pTemplate="footer">
    <button class="btn btn-secondary me-3 p-2" (click)="toggleVisibleAddDeliveryInfoDialog(false)">Hu·ª∑</button>
    <button class="btn btn-primary p-2" (click)="onSubmitAddDeliveryInfoDialog()">Th√™m</button>
  </ng-template>
</p-dialog>

<!--Popup select delivery info-->
<p-dialog header="Ch·ªçn ƒë·ªãa ch·ªâ nh·∫≠n h√†ng c·ªßa b·∫°n" [(visible)]="visibleChangeDeliveryInfoDialog"
          [appendTo]="'body'" [modal]="true" [style]="{width: '480px'}"
          (onHide)="toggleVisibleChangeDeliveryInfoDialog(false)">
  <ng-template class="delivery-info-dialog-content" pTemplate="content">
    <div class="delivery-info-dialog-content">
      <p class="title">Danh s√°ch ƒë·ªãa ch·ªâ nh·∫≠n h√†ng</p>

      <div class="delivery-info-list" *ngFor="let receiverInfo of receiverInfoList; let i=index">
        <div class="cart mb-2" [ngClass]="{'cart-focus': i === selectedReceiverIndex}"
             (click)="changeReceiverInfoSelection(i)" role="button">
          <p class="d-flex align-content-center">
            <span class="cart-label me-1">T√™n:</span>
            <span class="cart-value">{{ receiverInfo.name }}</span>
          </p>
          <p>
            <span class="cart-label me-1">S·ªë ƒëi·ªán tho·∫°i:</span>
            <span class="cart-value">{{ receiverInfo.phoneNumber }}</span>
          </p>
          <p>
            <span class="cart-label me-1">ƒê·ªãa ch·ªâ:</span>
            <span class="cart-value">{{ receiverInfo.address }}</span>
          </p>
          <p>
            <span class="cart-label me-1">Qu·∫≠n:</span>
            <span class="cart-value">{{ receiverInfo.district || '' }}</span>
          </p>
          <p class="m-0">
            <span class="cart-label me-1">Th√†nh ph·ªë:</span>
            <span class="cart-value">{{ receiverInfo.city || '' }}</span>
          </p>
        </div>
      </div>
    </div>
  </ng-template>

  <ng-template pTemplate="footer">
    <button class="btn btn-secondary me-3 p-2" (click)="toggleVisibleChangeDeliveryInfoDialog(false)">
      Hu·ª∑
    </button>
    <button class="btn btn-primary p-2" (click)="onSelectDeliveryInfo()"
            [disabled]="!(selectedReceiverIndex >= 0)">
      Ch·ªçn
    </button>
  </ng-template>

</p-dialog>

<!-- Popup Select branch -->
<p-dialog header="Ch·ªçn chi nh√°nh" [(visible)]="visibleChangeBranchDialog"
          [appendTo]="'body'" [modal]="true" [style]="{width: '480px'}"
          (onHide)="toggleVisibleChangeBranchDialog(false)">
  <ng-template class="branch-dialog-content" pTemplate="content">
    <div class="branch-dialog-content">
      <p class="title">Danh s√°ch chi nh√°nh</p>

      <div class="branch-list" *ngFor="let branch of branches; let i=index">
        <div class="cart mb-2" [ngClass]="{'cart-focus': i === selectedBranchIndex}"
             (click)="changeBranchSelection(i)" role="button">
          <p class="d-flex align-content-center">
            <span class="cart-label me-1">T√™n nh√† thu·ªëc:</span>
            <span class="cart-value">Nh√† thu·ªëc {{ i + 1 }}</span>
          </p>
          <p>
            <span class="cart-label me-1">ƒê·ªãa ch·ªâ:</span>
            <span class="cart-value">{{ branch.address }}</span>
          </p>
          <p>
            <span class="cart-label me-1">Qu·∫≠n:</span>
            <span class="cart-value">{{ branch.district.name || '' }}</span>
          </p>
          <p class="m-0">
            <span class="cart-label me-1">Th√†nh ph·ªë:</span>
            <span class="cart-value">{{ branch.district.city?.name || '' }}</span>
          </p>
        </div>
      </div>
    </div>

  </ng-template>

  <ng-template pTemplate="footer">
    <button class="btn btn-secondary me-3 p-2" (click)="toggleVisibleChangeBranchDialog(false)">
      Hu·ª∑
    </button>
    <button class="btn btn-primary p-2" (click)="onSelectBranch()"
            [disabled]="!(selectedBranchIndex >= 0)">
      Ch·ªçn
    </button>
  </ng-template>
</p-dialog>

<app-layout [style]="{'background': 'transparent'}">
  <div class="row pb-3">
    <div class="container-fluid col-8">
      <div class="cart-container">
        <div class="list-container p-3">

          <div class="cart-header d-flex flex-column justify-content-between align-items-start mb-2">
            <div class="header-title d-flex align-items-center">
              <p-badge class="me-2" [value]="'1'"></p-badge>
              <span>Gi·ªè h√†ng</span>
            </div>
            <div class="header-desc d-flex mt-2">
              <p>{{ cartData.items.length }} s·∫£n ph·∫©m - {{ cartData.totalPrice | VNCurrency }}</p>
              <p class="btn-change-cart ms-2" role="button" routerLink="..">Nh·∫•n ƒë·ªÉ thay ƒë·ªïi</p>
            </div>
          </div>

          <div class="cart-list">
            <p-table [value]="cartData.items">
              <ng-template class="list-header" pTemplate="header">
                <tr>
                  <th>S·∫£n ph·∫©m</th>
                  <th>ƒê∆°n gi√°</th>
                  <th>S·ªë l∆∞·ª£ng</th>
                  <th>Th√†nh ti·ªÅn</th>
                </tr>
              </ng-template>
              <ng-template class="list-body" pTemplate="body" let-item>
                <tr>
                  <td class="product-thumbnail">
                    <img [src]="item?.imageUrl" alt="">
                  </td>
                  <td>{{ item.price | VNCurrency }}</td>
                  <td>{{item.quantity}}</td>
                  <td>{{item.price * item.quantity | VNCurrency}}</td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>

        <div class="delivery-info-container mt-4 p-3">
          <div class="delivery-info-header d-flex flex-column justify-content-between align-items-start mb-2">
            <div class="header-title d-flex align-items-center">
              <p-badge class="me-2" [value]="'2'"></p-badge>
              <span>Th√¥ng tin giao h√†ng</span>
            </div>
          </div>
          <div class="delivery-tab">
            <p-tabMenu [model]="deliveryInfoTabItems" [activeItem]="deliveryInfoActiveTab"></p-tabMenu>

            <ng-container [ngSwitch]="deliveryInfoActiveTab.id">
              <div class="available-delivery-info ps-3"
                   *ngSwitchCase="'available-delivery'">
                <div *ngIf="isReceiverListEmpty">
                  <div class="no-data d-flex justify-content-center align-items-center pt-4">
                    <p>Ch∆∞a c√≥ th√¥ng tin nh·∫≠n h√†ng c√≥ s·∫µn n√†o, c·∫≠p nh·∫≠t ngay üëâ</p>
                  </div>
                </div>
                <div *ngIf="!isReceiverListEmpty">
                  <div *ngIf="selectedReceiverInfo" class="delivery-info-content cart my-2">
                    <p class="d-flex align-content-center">
                      <span class="cart-label me-1">T√™n:</span>
                      <span class="cart-value">ƒê·ª©c Tr∆∞∆°ng</span>
                    </p>
                    <p>
                      <span class="cart-label me-1">S·ªë ƒëi·ªán tho·∫°i:</span>
                      <span class="cart-value">{{ selectedReceiverInfo.phoneNumber }}</span>
                    </p>
                    <p>
                      <span class="cart-label me-1">ƒê·ªãa ch·ªâ:</span>
                      <span class="cart-value">{{ selectedReceiverInfo.address }}</span>
                    </p>
                    <p>
                      <span class="cart-label me-1">Qu·∫≠n:</span>
                      <span class="cart-value">{{ selectedReceiverInfo.district || '' }}</span>
                    </p>
                    <p class="m-0">
                      <span class="cart-label me-1">Th√†nh ph·ªë:</span>
                      <span class="cart-value">{{ selectedReceiverInfo.city || '' }}</span>
                    </p>
                  </div>
                  <div class="btn-select-delivery-info">
                    <button type="button" class="btn btn-outline-primary d-flex mt-4 p-2"
                            (click)="toggleVisibleChangeDeliveryInfoDialog(true)">
                      {{ 'Ch·ªçn ƒë·ªãa ch·ªâ nh·∫≠n h√†ng' }}
                    </button>
                  </div>
                </div>
              </div>

              <div class="add-delivery-info d-flex justify-content-center"
                   *ngSwitchCase="'add-delivery'">
                <div class="btn-edit-delivery-info">
                  <button type="button" class="btn-buy-more btn btn-outline-success d-flex mt-4 p-2"
                          (click)="toggleVisibleAddDeliveryInfoDialog(true)">
                    {{ 'Th√™m ƒë·ªãa ch·ªâ nh·∫≠n h√†ng' }}
                  </button>
                </div>
              </div>

            </ng-container>
          </div>
        </div>

        <div class="delivery-method-container mt-4 p-3">
          <div class="delivery-method-header d-flex flex-column justify-content-between align-items-start mb-2">
            <div class="header-title d-flex align-items-center">
              <p-badge class="me-2" [value]="'3'"></p-badge>
              <span>Ch·ªçn h√¨nh th·ª©c giao h√†ng</span>
            </div>
          </div>
          <div class="delivery-method-tab">
            <p-tabMenu [model]="methodTabItems" [activeItem]="activeMethodTab"></p-tabMenu>
            <ng-container [ngSwitch]="activeMethodTab.id">
              <div class="delivery-method-content d-flex mt-3 ms-3" *ngSwitchCase="'cod'">
                <p>ƒê∆°n v·ªã v·∫≠n chuy·ªÉn:</p>
                <p class="btn-choice-method ms-2" role="button">Ch·ªçn h√¨nh th·ª©c thanh to√°n ·ªü m·ª•c 4</p>
              </div>
              <div class="delivery-method-content branch-content ps-3" *ngSwitchCase="'offline'">
                <div class="d-flex mt-3 ms-3">
                  <p>ƒê·ªãa ch·ªâ nh√† thu·ªëc:</p>
                  <p class="btn-choice-method ms-2" role="button"
                     (click)="toggleVisibleChangeBranchDialog(true)">
                    Ch·ªçn c·ª≠a h√†ng b·∫°n mu·ªën nh·∫≠n
                  </p>
                </div>
                <div *ngIf="selectedBranch" class="cart mb-2">
                  <p class="d-flex align-content-center">
                    <span class="cart-label me-1">T√™n nh√† thu·ªëc:</span>
                    <span class="cart-value">Nh√† thu·ªëc Happy care</span>
                  </p>
                  <p>
                    <span class="cart-label me-1">ƒê·ªãa ch·ªâ:</span>
                    <span class="cart-value">{{ selectedBranch.address }}</span>
                  </p>
                  <p>
                    <span class="cart-label me-1">Qu·∫≠n:</span>
                    <span class="cart-value">{{ selectedBranch.district.name || '' }}</span>
                  </p>
                  <p class="m-0">
                    <span class="cart-label me-1">Th√†nh ph·ªë:</span>
                    <span class="cart-value">{{ selectedBranch.district.city?.name || '' }}</span>
                  </p>
                </div>
              </div>
            </ng-container>
          </div>
        </div>

        <div *ngIf="activeMethodTab.id === 'cod'" class="payment-method-container mt-4 p-3">
          <div class="payment-header d-flex flex-column justify-content-between align-items-start mb-4">
            <div class="header-title d-flex align-items-center">
              <p-badge class="me-2" [value]="'4'"></p-badge>
              <span>Ch·ªçn h√¨nh th·ª©c thanh to√°n</span>
            </div>
          </div>

          <div class="btn-payment d-flex align-items-center p-2 ms-3" [ngClass]="{'selected-payment': selectedPaymentMethod === 'CASH'}"
               role="button" (click)="changePaymentMethod('CASH')" >
            <span class="app-icon app-icon-logo-money"></span>
            <span class="payment-content d-flex flex-column ms-3">
              <p>Ti·ªÅn m·∫∑t</p>
              <p class="mt-2">Thanh to√°n b·∫±ng ti·ªÅn m·∫∑t khi nh·∫≠n h√†ng</p>
            </span>
          </div>
          <div class="btn-payment d-flex align-items-center ms-3 mt-3 p-2" [ngClass]="{'selected-payment': selectedPaymentMethod === 'VNPAY'}"
               role="button" (click)="changePaymentMethod('VNPAY')">
            <span class="app-icon app-icon-vnpay"></span>
            <span class="payment-content d-flex flex-column ms-3">
              <p>VN Pay</p>
              <p class="mt-2">Thanh to√°n b·∫±ng VN Pay</p>
            </span>
          </div>
        </div>
      </div>

    </div>

    <div class="container-fluid col-4">
      <div class="summary-container p-3">
        <div class="summary-header">
          <p>T·ªïng ti·ªÅn</p>
        </div>
        <div class="price-container d-flex justify-content-between align-items-center mt-4">
          <p class="text-price">T·∫°m t√≠nh</p>
          <p class="price">{{ cartData.totalPrice | VNCurrency }}</p>
        </div>
        <div class="price-container d-flex justify-content-between align-items-center mt-4">
          <p class="text-price">Th√†nh ti·ªÅn <span class="text-price-vat">(ƒê√£ bao g·ªìm VAT)</span> </p>
          <p class="price total-price">{{ cartData.totalPrice | VNCurrency }}</p>
        </div>
        <div class="btn-order d-flex justify-content-center align-items-center mt-3">
          <button type="button" class="col-12 btn-order btn me-3" (click)="onSubmitOrder()">
            ƒê·∫∑t h√†ng
          </button>
        </div>
      </div>
    </div>
  </div>

  <app-alert [(displayAlert)]="isVisibleAlertBox" [isDisabled]="false"
             text="{{ alertTitle }}" textCancelButton="OK"
             (close)="hideAlertBox()" type='warning'>
  </app-alert>
</app-layout>
